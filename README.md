# AutoDock Vina Grid Search Script
This repository provides Bash scripts for automating the protein space scanning process using AutoDock Vina. The scripts simplify the grid search process across the x, y, and z axes and facilitate the storage of important information, including coordinates, binding affinity scores, and PDB structures. With these scripts, you can streamline the grid search process for protein-ligand docking using [AutoDock Vina](http://vina.scripps.edu/).
This script represents an evolved version of a bash script originally utilized in the following paper:</br>

[**Computational Modeling of the Virucidal Inhibition Mechanism for Broad-Spectrum Antiviral Nanoparticles and HPV16 Capsid Segments**
](https://pubs.acs.org/doi/full/10.1021/acs.jpcb.1c07436) </br>

Chaturvedi, P., **Kelich, P.**, Nitka, T. A., & Vuković, L. (2021). Title of the Article. _The Journal of Physical Chemistry B_, 125(48), 13122-13131. [https://doi.org/10.1021/acs.jpcb.1c07436](https://doi.org/10.1021/acs.jpcb.1c07436)


If you utilize this bash script in your work, please kindly cite the paper


## Repository Contents

This repository contains the following main Bash scripts:

1. **vinasc**: This script automates the grid search process for protein-ligand docking using AutoDock Vina. It scans the protein space along the x, y, and z axes, saving the coordinates, binding affinity scores, and PDB structures.

2. **vinasc_split**: This script splits the PDBQT files generated by AutoDock Vina and converts them to the PDB format. It facilitates further analysis or visualization of the protein-ligand complexes.


## Table of Contents  
- [Prerequisite](#prerequisite)
- [vinasc](#vinasc)
    - [Usage](#usage)
    - [Options](#options)
    - [Output](#output)
- [vinasc_split](#vinasc_split)
    - [Usage](#usage-1)
    - [Options](#options-1)
    - [Output](#output-1)
- [Example](#example)
- [Contact](#contact)


## Prerequisite

To use the Bash scripts for protein space scanning and grid search with AutoDock Vina, vina and vina_split need to be installed, You can download it from the official AutoDock Vina website: [AutoDock Vina](http://vina.scripps.edu/). Ensure that the vina and vina_split binary is executable and accessible via the system's PATH environment variable.


## vinasc
This script automates protein-ligand docking using AutoDock Vina. It requires the PDBQT files of the ligand and receptor, which can be created using [MGLTools](https://ccsb.scripps.edu/mgltools/downloads/). The script performs docking based on the user-provided coordinate range and generates a CSV file and a folder with the results.
### Usage
You need to give a execuation permission to the code by using the below command:
```bash
chmod 755 vinasc
```
Run the Bash script by executing the command:

```bash
nohup ./vinasc [-r [<.pdbqt>]] [-l [<.pdbqt>]] [-b <positive int>] 
         [-x <float>] [-X <float>] [--step-x <positive float>] 
         [-y <float>] [-Y <float>] [--step-y <positive float>] 
         [-z <float>] [-Z <float>] [--step-z <positive float>] 
         [--fixed-x <float>] [--fixed-y <float>] [--fixed-z <float>] 
         [-v <directory/binary>] >> vina_sc.log
```
**Note:** To avoid losing your command progress, it's advantageous to utilize nohup. This allows your process to continue running even if the terminal is closed or the session is disconnected.

### Options
All options come in both short and long forms for added flexibility. However, for the sake of clarity, the 'step' and 'fixed' options are exclusively provided in the long form.
| Short Option | Long Option  | Default | Description |
| ------ | ----------- | ------- | ------- |
| `-r` | `--receptor` | protein.pdbqt | Receptor PDBQT file name <sup>★</sup>|
| `-l` | `--ligand` | ligand.pdbqt | Ligand PDBQT file name <sup>★</sup>  |
| `-b` | `--box` | 10 | Box size |
| `-x` | `--start-x` | -5 | Start x-coordinate |
| `-X` | `--end-x` | 5 | End x-coordinate |
| NA | `--step-x` | 5 | Step size for x-coordinate |
| `-y` | `--start-y` | -5 | Start y-coordinate |
| `-Y` | `--end-y` | 5 | End y-coordinate |
| NA | `--step-y` | 5 | Step size for y-coordinate |
| `-z` | `--start-z` | -5 | Start z-coordinate |
| `-Z` | `--end-z` | 5 | End z-coordinate |
| NA | `--step-z` | 5 | Step size for z-coordinate |
| NA | `--fixed-x` | Not set | Fixed x-coordinate |
| NA | `--fixed-y` | Not set | Fixed y-coordinate |
| NA | `--fixed-z` | Not set | Fixed z-coordinate |
| `-S` | `--seed` | Generated by Script | Random seed for Vina execution |
| `-v` | `--vina-path` | Not set | Path to AutoDock Vina binary |
| `-h` | `--help` | Not set | Shows the help  |

★ The file must reside in the same directory as the `viansc` executable.

If `--fixed-x`, `--fixed-y`, or `--fixed-z` are set, the respective coordinates will not change during the grid search.

### Output

The script creates a directory named `result_seed_<seed>`, in which it saves all the output files for each grid point. These files include:

- `conf-x-y-z`: Configuration file used by Vina.
- `pdbq-x-y-z.pdbqt`: Output file generated by Vina containing the binding modes.
- `log-x-y-z.log`: Log file generated by Vina.

Furthermore, the script creates a CSV file, `affinity_seed_<seed>.csv`, which enumerates the affinity at each grid point. This file comprises four columns: x, y, z, and Affinity (kcal/mol).





## vinasc_split


This script processes the data generated by AutoDock Vina, creates structure files for each ligand that meets certain energy criteria, and organizes them in a structured directory. It is helpful for further examination or visualization of protein-ligand interactions that have specific binding affinity.

### Usage
1. You need to give a execuation permission to the code by using the below command:
```bash
chmod 755 vinasc_split
```
2. Make sure your receptor files in PDBQT format and the data are present in the same directory as the scripts.
3. Please refrain from altering the names of the CSV file and result directory, as these are outputs generated by the vinasc_split.



You can run the script with optional parameters:

```bash
nohup ./vinasc_split [-r [<.pdbqt>]] [-n [<int>]] [-e <float>] [-v <directory/binary>] >> vina_split.log &
```
**Note:** To avoid losing your command progress, it's advantageous to utilize nohup. This allows your process to continue running even if the terminal is closed or the session is disconnected.

### Options

| Short Option | Long Option       | Description                                | Default                   |
| ------------- | ------- | ------------------------------------------ | ------------------------- |
| `-r` | `--receptor` | Path to the receptor PDBQT file            | protein.pdbqt
| `-n` | `--number`   | Seed number to process                     | None (mandatory to provide)<sup>❇</sup>|
| `-e` | `--energy-range` | Energy range value to filter ligands     | -1.0 (kcal/mol)|
| `-v` | `--vina-path` | Path to the vina_split binary               | `vina_split`              |
| `-h` | `--help`     | Display the help message                    | None                      |

❇ The number can be identified from the CSV file generated by the vinasc script. For example, if the CSV file is named **affinity_seed_1234.csv**, then **1234** is the number you're looking for.

## Output
Running this command will generate two types of outputs:

- A directory named `structure_<seed_number>`, which contains two subdirectories:
  - `ligand`: This directory holds the highest affinity docked structure alone for each coordinate.
  - `final`: This directory stores the highest affinity docked structure alongside the target receptor for each coordinate.
    
- A PDB file named `merged_<seed_number>.pdb` is also generated. It contains all the ligand structures with different `segID`. The final column in the PDB file holds the affinity energy, placed in the occupancy column for visualization using [VMD](https://www.ks.uiuc.edu/Development/Download/download.cgi?PackageName=VMD) or [ChimeraX](https://www.rbvi.ucsf.edu/chimerax/download.html) software.

Please replace `<seed_number>` with the specific seed number used in your script.




## Example

In this example, we are using two PDBQT files: `m1.pdbqt` as the ligand and `fin.pdbqt` as the receptor. Since the file names deviate from the default, it's mandatory to specify them using the appropriate options. Additionally, the random seed will be provided by the user.

```bash
nohup ./vinasc -r fin.pdbqt -l m1.pdbqt --step-y 1 -y -1 -Y 2 --fixed-z 5 --seed 1234 >> vinasc_1234.log
```

In the above command, **fin.pdbqt** and **m1.pdbqt** represent the receptor and ligand, respectively. The x-coordinate uses the default value. The y-coordinate ranges from -1 to 2, with an increment of 1. The z-coordinate is fixed at 5 Angstroms. Therefore, according to the command, the coordinates are x={-5,0,5}, y={-1,0,1,2}, and z=5.

Upon completion, the output will be **result_1234**, **affinity_seed_1234.csv**, and **vinasc_123.log**. To run the subsequent script, we need the number **1234** extracted from these output files. Please note that the names of **result_1234** and **affinity_seed_1234.csv** <u>should not be modified</u>.

You are now ready to run the **vinasc_split** command:

```bash
nohup ./vinasc_split -r fin.pdbqt -n 1234 -e -1 >> vinasc_split_1234.log
```
Running this command will generate two types of outputs:

- A directory named **structure_1234**, which contains two subdirectories:

    - **ligand**: This directory holds the highest affinity docked structure alone for each coordinate.
    - **final**: This directory stores the highest affinity docked structure alongside the target receptor for each coordinate.
- A PDB file named **merged_1234.pdb** is also generated. It contains all the ligand structures with different **segID**. The final column in the PDB file holds the affinity energy, placed in the occupancy column for visualization using [VMD](ks.uiuc.edu/Development/Download/download.cgi?PackageName=VMD) or [ChimeraX](https://www.cgl.ucsf.edu/chimera/download.html) software.


## Contact

Please feel free to [contact](https://payamkelich.github.io/) the author if you have any questions or suggestions.


